import ROOT

############################################################
map_parameters = {
	"Gtt":  ((4.46085,-0.660681),(-3.36515, -1.97966)),
	"Gqq":	((4.51991,-0.593662),(-6.34604, -1.99389)),
}

def log10udd_to_BR(udd, model):
  if model in map_parameters:
    parameters = map_parameters[model][0]
    f = ROOT.TF1("f","1./(1+exp(-[0]*(x-[1])))")
    f.SetParameters(*parameters)
    return f.Eval(udd)
  else:
    if (model, udd) in map_BRbs:
      return map_BRbs[(model, udd)]
    else:
      return -1
		

def BR_to_log10udd(br, model):
	if model in map_parameters:
		parameters = map_parameters[model][0]
		g = ROOT.TF1("g","[1]-log(1./x -1)/[0]")
		g.SetParameters(*parameters)
		return g.Eval(br)
	else:
		lowbr ,highbr =0,1
		lowudd,highudd=-5,1.5
		for (mass, udd), mbr in map_BRbs.iteritems():
			if mass!=model: continue
			if mbr > br and mbr < highbr:
				highbr, highudd = mbr, udd
			if mbr < br and mbr > lowbr:
				lowbr, lowudd = mbr, udd
		if highudd==1.5: raise FailedToInterpolateBR
		return (lowudd*(highbr-br)+highudd*(br-lowbr))/(highbr-lowbr)
		

def log10udd_to_log10lifetime(udd, model):
	if model in map_parameters:
		parameters = map_parameters[model][1]
		f = ROOT.TF1("f","[0]+[1]*x")
		f.SetParameters(*parameters)
		return f.Eval(udd)
	else:
		if (model, udd) in map_ctau:
			return map_ctau[(model, udd)]
		else:
			raise PointNotInCTauMap

def log10lifetime_to_log10udd(lifetime, model):
	if model in map_parameters:
		parameters = map_parameters[model][1]
		g = ROOT.TF1("g","(x-[0])/[1]")
		g.SetParameters(*parameters)
		return g.Eval(lifetime)
	else:
		ctau = lifetime
		lowctau ,highctau =-10,10
		lowudd,highudd=-5,1.5
		for (mass, udd), mctau in map_ctau.iteritems():
			if mass!=model: continue
			if mctau > ctau and mctau < highctau:
				highctau, highudd = mctau, udd
			if mctau < ctau and mctau > lowctau:
				lowctau, lowudd = mctau, udd
		if highudd==1.5: raise FailedToInterpolateBR
		return (lowudd*(highctau-ctau)+highudd*(ctau-lowctau))/(highctau-lowctau)


map_BRbs = {
	#(stop mass, log10(udd)) : BR(bs)
	( 400,-4.0):0.000,
	( 500,-4.0):0.000,
	( 600,-4.0):0.000,
	( 700,-4.0):0.000,
	( 800,-4.0):0.000,
	( 900,-4.0):0.000,
    (1000,-4.0):0.000,
	(1100,-4.0):0.000,
    (1200,-4.0):0.000,
	(1400,-4.0):0.000,
    (1500,-4.0):0.000,
    (1800,-4.0):0.000,
	(1900,-4.0):0.000,
    (2000,-4.0):0.000,
    (2400,-4.0):0.000,
	( 400,-3.0):0.000,
	( 500,-3.0):0.000,
	( 600,-3.0):0.000,
	( 700,-3.0):0.000,
	( 800,-3.0):0.000,
	( 900,-3.0):0.000,
    (1000,-3.0):0.000,
	(1100,-3.0):0.000,
    (1200,-3.0):0.000,
	(1400,-3.0):0.000,
    (1500,-3.0):0.000,
    (1800,-3.0):0.000,
	(1900,-3.0):0.000,
    (2000,-3.0):0.000,
    (2400,-3.0):0.000,
	( 400,-2.0):0.011,
	( 500,-2.0):0.004,
	( 600,-2.0):0.003,
	( 700,-2.0):0.002,
	( 800,-2.0):0.002,
	( 900,-2.0):0.002,
    (1000,-2.0):0.002,
	(1100,-2.0):0.002,
    (1200,-2.0):0.002,
	(1400,-2.0):0.002,
    (1500,-2.0):0.002,
    (1800,-2.0):0.002,
	(1900,-2.0):0.002,
    (2000,-2.0):0.002,
    (2400,-2.0):0.002, # Kate added
	( 400,-1.5):0.096,
	( 500,-1.5):0.036,
	( 600,-1.5):0.027,
	( 700,-1.5):0.023,
	( 800,-1.5):0.021,
	( 900,-1.5):0.020,
	(1000,-1.5):0.020,
	(1100,-1.5):0.019,
	(1200,-1.5):0.019,
	(1300,-1.5):0.018,
	(1400,-1.5):0.018,
	(1500,-1.5):0.018,
	(1600,-1.5):0.018,
	(1700,-1.5):0.018,
	(1800,-1.5):0.018,
	(1900,-1.5):0.018,
	(2000,-1.5):0.017,
	(2100,-1.5):0.017,
	(2300,-1.5):0.017,
    (2400,-1.5):0.017,
	(2500,-1.5):0.017,
	( 400,-1.2):0.279,
	( 500,-1.2):0.128,
	( 600,-1.2):0.098,
	( 700,-1.2):0.087,
	( 800,-1.2):0.080,
	( 900,-1.2):0.076,
	(1000,-1.2):0.074,
	(1100,-1.2):0.072,
	(1200,-1.2):0.071,
	(1300,-1.2):0.069,
	(1400,-1.2):0.069,
	(1500,-1.2):0.068,
	(1600,-1.2):0.068,
	(1700,-1.2):0.067,
	(1800,-1.2):0.067,
	(1900,-1.2):0.066,
	(2000,-1.2):0.066,
	(2100,-1.2):0.066,
	(2300,-1.2):0.066,
    (2400,-1.2):0.065, # Kate added
	(2500,-1.2):0.065,
	( 400,-1.0):0.455,
	( 500,-1.0):0.265,
	( 600,-1.0):0.219,
	( 700,-1.0):0.192,
	( 800,-1.0):0.181,
	( 900,-1.0):0.172,
	(1000,-1.0):0.165,
	(1200,-1.0):0.161,
	(1500,-1.0):0.155,
    (1800,-1.0):0.153, # Kate added
	(2000,-1.0):0.151,
    (2400,-1.0):0.150, # Kate added
	( 400,-0.9):0.637,
	( 500,-0.9):0.374,
	( 600,-0.9):0.305,
	( 700,-0.9):0.276,
	( 800,-0.9):0.258,
	( 900,-0.9):0.248,
	(1000,-0.9):0.240,
	(1100,-0.9):0.236,
	(1200,-0.9):0.232,
	(1300,-0.9):0.229,
	(1400,-0.9):0.227,
	(1500,-0.9):0.225,
	(1600,-0.9):0.224,
	(1700,-0.9):0.223,
	(1800,-0.9):0.222,
	(1900,-0.9):0.221,
	(2000,-0.9):0.220,
	(2100,-0.9):0.219,
	(2300,-0.9):0.219,
    (2400,-0.9):0.218, # Kate added
	(2500,-0.9):0.218,
	( 400,-0.8):0.682,
	( 500,-0.8):0.477, ############
	( 600,-0.8):0.407,
	( 700,-0.8):0.375,
	( 800,-0.8):0.355,
	( 900,-0.8):0.343,
	(1000,-0.8):0.334,
	(1100,-0.8):0.328,
	(1200,-0.8):0.323,
	(1300,-0.8):0.320,
	(1400,-0.8):0.318,
	(1500,-0.8):0.315,
	(1600,-0.8):0.313,
	(1700,-0.8):0.312,
	(1800,-0.8):0.311,
	(1900,-0.8):0.310,
	(2000,-0.8):0.309,
	(2100,-0.8):0.308,
	(2300,-0.8):0.307,
    (2400,-0.8):0.306, # Kate added
	(2500,-0.8):0.306,
	( 400,-0.7):0.777,
	( 500,-0.7):0.594, ##################
	( 600,-0.7):0.523,
	( 700,-0.7):0.489,
	( 800,-0.7):0.467,
	( 900,-0.7):0.453,
	(1000,-0.7):0.443,
	(1100,-0.7):0.437,
	(1200,-0.7):0.431,
	(1300,-0.7):0.427,
	(1400,-0.7):0.424,
	(1500,-0.7):0.422,
	(1600,-0.7):0.420,
	(1700,-0.7):0.418,
	(1800,-0.7):0.417,
	(1900,-0.7):0.416,
	(2000,-0.7):0.415,
    (2400,-0.7):0.412, # Kate added
	( 400,-0.6):0.872,
	( 500,-0.6):0.694,
	( 600,-0.6):0.633,
	( 700,-0.6):0.602,
	( 800,-0.6):0.581,
	( 900,-0.6):0.568,
	(1000,-0.6):0.558,
	(1100,-0.6):0.551,
	(1200,-0.6):0.546,
	(1300,-0.6):0.542,
	(1400,-0.6):0.539,
	(1500,-0.6):0.536,
	(1600,-0.6):0.534,
	(1700,-0.6):0.533,
	(1800,-0.6):0.531,
	(1900,-0.6):0.530,
	(2000,-0.6):0.529,
    (2400,-0.6):0.525, # Kate added
	( 400,-0.5):0.898,
	( 500,-0.5):0.790,
	( 600,-0.5):0.732,
	( 700,-0.5):0.706,
	( 800,-0.5):0.688,
	( 900,-0.5):0.675,
	(1000,-0.5):0.667,
	(1100,-0.5):0.660,
	(1200,-0.5):0.656,
	(1300,-0.5):0.652,
	(1400,-0.5):0.649,
	(1500,-0.5):0.647,
	(1600,-0.5):0.645,
	(1700,-0.5):0.644,
	(1800,-0.5):0.642,
	(1900,-0.5):0.641,
	(2000,-0.5):0.640,
    (2400,-0.5):0.636, # Kate added
	( 400,-0.4):0.930,
	( 500,-0.4):0.851,
	( 600,-0.4):0.815,
	( 700,-0.4):0.792,
	( 800,-0.4):0.776,
	( 900,-0.4):0.767,
	(1000,-0.4):0.760,
	(1100,-0.4):0.755,
	(1200,-0.4):0.751,
	(1300,-0.4):0.748,
	(1400,-0.4):0.746,
	(1500,-0.4):0.744,
	(1600,-0.4):0.742,
	(1700,-0.4):0.741,
	(1800,-0.4):0.740,
	(1900,-0.4):0.739,
	(2000,-0.4):0.738,
    (2400,-0.4):0.735, # Kate added
	( 400,-0.3):0.964,
	( 500,-0.3):0.903,
	( 600,-0.3):0.873,
	( 700,-0.3):0.857,
	( 800,-0.3):0.846,
	( 900,-0.3):0.839,
	(1000,-0.3):0.834,
	(1100,-0.3):0.830,
	(1200,-0.3):0.827,
	(1300,-0.3):0.825,
	(1400,-0.3):0.823,
	(1500,-0.3):0.821,
	(1600,-0.3):0.820,
	(1700,-0.3):0.819,
	(1800,-0.3):0.818,
	(1900,-0.3):0.818,
	(2000,-0.3):0.817,
	(2100,-0.3):0.817,
    (2400,-0.3):0.815, # Kate added
	( 400,-0.2):0.974,
	( 500,-0.2):0.935,
	( 600,-0.2):0.916,
	( 700,-0.2):0.905,
	( 800,-0.2):0.897,
	( 900,-0.2):0.892,
	(1000,-0.2):0.888,
	(1100,-0.2):0.886,
	(1200,-0.2):0.883,
	(1300,-0.2):0.882,
	(1400,-0.2):0.880,
	(1500,-0.2):0.879,
	(1600,-0.2):0.879,
	(1700,-0.2):0.878,
	(1800,-0.2):0.877,
	(1900,-0.2):0.877,
	(2000,-0.2):0.876,
	(2100,-0.2):0.876,
    (2400,-0.2):0.874, # Kate added
	( 500,-0.1):0.958,
	( 600,-0.1):0.945,
	( 700,-0.1):0.938,
	( 800,-0.1):0.932,
	( 900,-0.1):0.929,
	(1000,-0.1):0.926,
	(1100,-0.1):0.924,
	(1200,-0.1):0.923,
	(1300,-0.1):0.922,
	(1400,-0.1):0.921,
	(1500,-0.1):0.920,
	(1600,-0.1):0.920,
	(1700,-0.1):0.919,
	(1800,-0.1):0.919,
	(1900,-0.1):0.918,
	(2000,-0.1):0.918,
	(2100,-0.1):0.918,
    (2400,-0.1):0.917, # Kate added
    ( 500,-0.0):0.964, # Kate added
    ( 600,-0.0):0.962, # Kate added
	( 700,-0.0):0.958,
	( 800,-0.0):0.956,
	( 900,-0.0):0.954,
	(1000,-0.0):0.952,
	(1100,-0.0):0.951,
	(1200,-0.0):0.950,
	(1300,-0.0):0.949,
	(1400,-0.0):0.949,
	(1500,-0.0):0.948,
	(1600,-0.0):0.948,
	(1700,-0.0):0.947,
	(1800,-0.0):0.947,
	(1900,-0.0):0.947,
	(2000,-0.0):0.947,
	(2100,-0.0):0.947,
	(2200,-0.0):0.946,
    (2400,-0.0):0.946, # Kate added
    (500,  0.2):0.982, # Kate added
    (600,  0.2):0.981, # Kate added
    (700,  0.2):0.981, # Kate added
    (800,  0.2):0.981, # Kate added
    (900,  0.2):0.981, # Kate added
    (1000, 0.2):0.980, # Kate added
    (1200, 0.2):0.980, # Kate added
	(1300, 0.2):0.979,
	(1400, 0.2):0.979,
	(1500, 0.2):0.979,
	(1600, 0.2):0.978,
	(1700, 0.2):0.978,
	(1800, 0.2):0.978,
	(1900, 0.2):0.978,
	(2000, 0.2):0.978,
	(2100, 0.2):0.978,
	(2200, 0.2):0.978,
	(2300, 0.2):0.978,
	(2400, 0.2):0.978,
	(2500, 0.2):0.978,
}

map_ctau = {
	#(stop mass, log10(udd)) : log10(ctau)
	( 400,-4.0):1.583,
	( 500,-4.0):1.983,
	( 600,-4.0):2.316,
	( 700,-4.0):2.574,
	( 800,-4.0):2.814,
	( 900,-4.0):3.015,
	(1100,-4.0):3.305,
	(1400,-4.0):3.719,
	(1900,-4.0):4.297,
	( 400,-3.0):-0.417,
	( 500,-3.0):-0.017,
	( 600,-3.0):0.316,
	( 700,-3.0):0.574,
	( 800,-3.0):0.814,
	( 900,-3.0):1.015,
	(1100,-3.0):1.305,
	(1400,-3.0):1.719,
	(1900,-3.0):2.297,
	( 400,-2.0):-2.416,
	( 500,-2.0):-2.016,
	( 600,-2.0):-1.683,
	( 700,-2.0):-1.426,
	( 800,-2.0):-1.186,
	( 900,-2.0):-0.985,
	(1100,-2.0):-0.695,
	(1400,-2.0):-0.281,
	(1900,-2.0):0.297,
	( 400,-1.5):-3.412,
	( 500,-1.5):-3.014,
	( 600,-1.5):-2.681,
	( 700,-1.5):-2.424,
	( 800,-1.5):-2.185,
	( 900,-1.5):-1.984,
	(1000,-1.5):-1.811,
	(1100,-1.5):-1.639,
	(1200,-1.5):-1.503,
	(1300,-1.5):-1.365,
	(1400,-1.5):-1.240,
	(1500,-1.5):-1.125,
	(1600,-1.5):-1.019,
	(1700,-1.5):-0.911,
	(1800,-1.5):-0.821,
	(1900,-1.5):-0.738,
	(2000,-1.5):-0.651,
	(2100,-1.5):-0.563,
	(2300,-1.5):-0.468,
	(2500,-1.5):-0.311,
	( 400,-1.2):-3.997,
	( 500,-1.2):-3.604,
	( 600,-1.2):-3.275,
	( 700,-1.2):-3.020,
	( 800,-1.2):-2.782,
	( 900,-1.2):-2.582,
	(1000,-1.2):-2.408,
	(1100,-1.2):-2.237,
	(1200,-1.2):-2.102,
	(1300,-1.2):-1.964,
	(1400,-1.2):-1.839,
	(1500,-1.2):-1.724,
	(1600,-1.2):-1.619,
	(1700,-1.2):-1.521,
	(1800,-1.2):-1.421,
	(1900,-1.2):-1.337,
	(2000,-1.2):-1.259,
	(2100,-1.2):-1.163,
	(2300,-1.2):-1.068,
	(2500,-1.2):-0.910,
	( 400,-1.0):-4.367,
	( 500,-1.0):-3.986,
	( 600,-1.0):-3.703,
	( 700,-1.0):-3.410,
	( 800,-1.0):-3.202,
	( 900,-1.0):-2.999,
	(1000,-1.0):-2.764,
	(1200,-1.0):-2.531,
	(1500,-1.0):-2.172,
	(2000,-1.0):-1.658,
	( 400,-0.9):-4.617,
	( 500,-0.9):-4.222,
	( 600,-0.9):-3.890,
	( 700,-0.9):-3.634,
	( 800,-0.9):-3.394,
	( 900,-0.9):-3.193,
	(1000,-0.9):-2.999,
	(1100,-0.9):-2.848,
	(1200,-0.9):-2.695,
	(1300,-0.9):-2.558,
	(1400,-0.9):-2.434,
	(1500,-0.9):-2.320,
	(1600,-0.9):-2.215,
	(1700,-0.9):-2.118,
	(1800,-0.9):-2.028,
	(1900,-0.9):-1.934,
	(2000,-0.9):-1.857,
	(2100,-0.9):-1.760,
	(2300,-0.9):-1.666,
	(2500,-0.9):-1.508,
	( 400,-0.8):-4.771,
	( 500,-0.8):-4.392,
	( 600,-0.8):-4.071,
	( 700,-0.8):-3.819,
	( 800,-0.8):-3.583,
	( 900,-0.8):-3.385,
	(1000,-0.8):-3.212,
	(1100,-0.8):-3.042,
	(1200,-0.8):-2.891,
	(1300,-0.8):-2.769,
	(1400,-0.8):-2.644,
	(1500,-0.8):-2.529,
	(1600,-0.8):-2.412,
	(1700,-0.8):-2.315,
	(1800,-0.8):-2.225,
	(1900,-0.8):-2.132,
	(2000,-0.8):-2.055,
	(2100,-0.8):-1.958,
	(2300,-0.8):-1.864,
	(2500,-0.8):-1.707,
	( 400,-0.7):-4.976,
	( 500,-0.7):-4.600,
	( 600,-0.7):-4.279,
	( 700,-0.7):-4.028,
	( 800,-0.7):-3.792,
	( 900,-0.7):-3.594,
	(1000,-0.7):-3.401,
	(1100,-0.7):-3.250,
	(1200,-0.7):-3.099,
	(1300,-0.7):-2.962,
	(1400,-0.7):-2.838,
	(1500,-0.7):-2.724,
	(1600,-0.7):-2.619,
	(1700,-0.7):-2.511,
	(1800,-0.7):-2.422,
	(1900,-0.7):-2.338,
	(2000,-0.7):-2.252,
	( 400,-0.6):-5.213,
	( 500,-0.6):-4.780,
	( 600,-0.6):-4.469,
	( 700,-0.6):-4.223,
	( 800,-0.6):-3.991,
	( 900,-0.6):-3.794,
	(1000,-0.6):-3.603,
	(1100,-0.6):-3.453,
	(1200,-0.6):-3.302,
	(1300,-0.6):-3.166,
	(1400,-0.6):-3.042,
	(1500,-0.6):-2.928,
	(1600,-0.6):-2.812,
	(1700,-0.6):-2.716,
	(1800,-0.6):-2.626,
	(1900,-0.6):-2.533,
	(2000,-0.6):-2.455,
	( 400,-0.5):-5.377,
	( 500,-0.5):-5.018,
	( 600,-0.5):-4.667,
	( 700,-0.5):-4.427,
	( 800,-0.5):-4.198,
	( 900,-0.5):-3.981,
	(1000,-0.5):-3.814,
	(1100,-0.5):-3.647,
	(1200,-0.5):-3.498,
	(1300,-0.5):-3.363,
	(1400,-0.5):-3.240,
	(1500,-0.5):-3.127,
	(1600,-0.5):-3.012,
	(1700,-0.5):-2.916,
	(1800,-0.5):-2.826,
	(1900,-0.5):-2.733,
	(2000,-0.5):-2.656,
	( 400,-0.4):-5.565,
	( 500,-0.4):-5.181,
	( 600,-0.4):-4.890,
	( 700,-0.4):-4.624,
	( 800,-0.4):-4.378,
	( 900,-0.4):-4.191,
	(1000,-0.4):-4.007,
	(1100,-0.4):-3.844,
	(1200,-0.4):-3.697,
	(1300,-0.4):-3.564,
	(1400,-0.4):-3.443,
	(1500,-0.4):-3.318,
	(1600,-0.4):-3.215,
	(1700,-0.4):-3.120,
	(1800,-0.4):-3.021,
	(1900,-0.4):-2.939,
	(2000,-0.4):-2.854,
	( 400,-0.3):-5.803,
	( 500,-0.3):-5.403,
	( 600,-0.3):-5.063,
	( 700,-0.3):-4.819,
	( 800,-0.3):-4.586,
	( 900,-0.3):-4.385,
	(1000,-0.3):-4.207,
	(1100,-0.3):-4.049,
	(1200,-0.3):-3.889,
	(1300,-0.3):-3.760,
	(1400,-0.3):-3.641,
	(1500,-0.3):-3.520,
	(1600,-0.3):-3.420,
	(1700,-0.3):-3.316,
	(1800,-0.3):-3.220,
	(1900,-0.3):-3.139,
	(2000,-0.3):-3.055,
	(2100,-0.3):-3.015,
	( 400,-0.2):-5.974,
	( 500,-0.2):-5.574,
	( 600,-0.2):-5.269,
	( 700,-0.2):-5.007,
	( 800,-0.2):-4.778,
	( 900,-0.2):-4.576,
	(1000,-0.2):-4.395,
	(1100,-0.2):-4.247,
	(1200,-0.2):-4.097,
	(1300,-0.2):-3.960,
	(1400,-0.2):-3.834,
	(1500,-0.2):-3.717,
	(1600,-0.2):-3.620,
	(1700,-0.2):-3.518,
	(1800,-0.2):-3.424,
	(1900,-0.2):-3.336,
	(2000,-0.2):-3.254,
	(2100,-0.2):-3.192,
	( 500,-0.1):-5.748,
	( 600,-0.1):-5.453,
	( 700,-0.1):-5.207,
	( 800,-0.1):-4.976,
	( 900,-0.1):-4.773,
	(1000,-0.1):-4.600,
	(1100,-0.1):-4.438,
	(1200,-0.1):-4.288,
	(1300,-0.1):-4.160,
	(1400,-0.1):-4.030,
	(1500,-0.1):-3.919,
	(1600,-0.1):-3.815,
	(1700,-0.1):-3.718,
	(1800,-0.1):-3.627,
	(1900,-0.1):-3.533,
	(2000,-0.1):-3.454,
	(2100,-0.1):-3.357,
	( 700,-0.0):-5.251,
	( 800,-0.0):-5.152,
	( 900,-0.0):-4.967,
	(1000,-0.0):-4.787,
	(1100,-0.0):-4.636,
	(1200,-0.0):-4.487,
	(1300,-0.0):-4.354,
	(1400,-0.0):-4.227,
	(1500,-0.0):-4.116,
	(1600,-0.0):-4.011,
	(1700,-0.0):-3.911,
	(1800,-0.0):-3.817,
	(1900,-0.0):-3.736,
	(2000,-0.0):-3.651,
	(2100,-0.0):-3.572,
	(2200,-0.0):-3.504,
	(1300, 0.2):-4.632,
	(1400, 0.2):-4.595,
	(1500, 0.2):-4.493,
	(1600, 0.2):-4.393,
	(1700, 0.2):-4.300,
	(1800, 0.2):-4.210,
	(1900, 0.2):-4.124,
	(2000, 0.2):-4.045,
	(2100, 0.2):-3.939,
	(2200, 0.2):-3.882,
	(2300, 0.2):-3.826,
	(2400, 0.2):-3.772,
	(2500, 0.2):-3.720,
}

if __name__ == "__main__": main()
